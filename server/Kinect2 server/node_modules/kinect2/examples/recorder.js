var Kinect2 = require('../lib/kinect2');

var kinect = new Kinect2();

if(kinect.open()) {
	console.log("Kinect Opened");
	//listen for body frames

	var recording = false;

	var frames = [];

	kinect.on('bodyFrame', function(bodyFrame){
		for(var i = 0;  i < bodyFrame.bodies.length; i++) {
			if(bodyFrame.bodies[i].tracked) {
				//console.log(bodyFrame.bodies[i]);
			}
		}
		if(recording) {
			frames.push(bodyFrame);
		}
	});

	//request body frames
	kinect.openBodyReader();

	setTimeout(function(){
		console.log('start recording');
		recording = true;
	}, 5000);

	//close the kinect after 5 seconds
	setTimeout(function(){
		require('fs').appendFileSync('bodyframes.json', JSON.stringify(frames));
		kinect.removeAllListeners('bodyFrame');
		kinect.close();
		console.log("Kinect Closed");
	}, 10000);
}
